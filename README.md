# AI Tutor Submodule

This submodule provides automated feedback for Python programming assignments by leveraging the Gemini AI model.

## Features

* **Automated feedback on failed test cases:** The AI Tutor analyzes pytest report files generated by the main project and provides explanations for the errors in beginner-friendly terms.
* **Consolidated feedback:** Multiple failed test cases are processed together to present the student with a comprehensive overview of the issues.
* **Context-aware:** The AI Tutor considers the assignment instructions and the student's code when generating feedback.
* **Rate limiting and retry logic:** The module handles rate limiting imposed by the Gemini API and retries failed requests to ensure robustness.

## Requirements

* **Google API Key:** You need to set the `GOOGLE_API_KEY` environment variable with your valid Google API key.
* **pytest:** The project relies on pytest for test execution and report generation.
* **requests:** The `requests` library is used for making API calls to Gemini.

## How to use

1. **Include as submodule:** Add this repository as a submodule to your Github Classroom template repository.
   ``` bash
   git submodule add https://url-to-this-repository [ai_tutor]
   ```
1. **Set API key:** Ensure the `GOOGLE_API_KEY` environment variable is set in your main project's environment.
1. **Run pytest:** Execute your pytest test suite as you normally would.
1. **Check output:** The AI Tutor's feedback will be printed to the console after the test execution.

### Possible `yaml` file changes
1. For the `.github` YAML file of the template repository, please checkout with submodules.
   ``` yaml
    - name: Checkout code
      uses: actions/checkout@v4
      with:
        submodules: 'true'
   ```
1. Before running tests, please set report file name variables.
   ``` yaml   
    - name: Set report file names
      id: json
      run: |
        echo "syntax=report_syntax.json" >> $GITHUB_OUTPUT
        echo "results=report_results.json" >> $GITHUB_OUTPUT
   ```
1. Generate JSON reports while running the test.
   ``` yaml   
    - name: check syntax
      id: check-syntax
      uses: classroom-resources/autograding-command-grader@v1
      with:
        test-name: check syntax
        setup-command: ". test-env/bin/activate && echo $VIRTUAL_ENV && python -m pip list"
        command: ". test-env/bin/activate && python -m pytest --json-report --json-report-file=${{ steps.json.outputs.syntax }} tests/test_syntax.py"
        timeout: 1
        max-score: 3

    - name: test results
      id: test-results
      uses: classroom-resources/autograding-command-grader@v1
      with:
        test-name: test results
        setup-command: ". test-env/bin/activate && echo $VIRTUAL_ENV && python -m pip list"
        command: ". test-env/bin/activate && python -m pytest -n auto --json-report --json-report-file=${{ steps.json.outputs.results }} tests/test_results.py"
        timeout: 2
        max-score: 2
   ```
1. After the tests, run the AI Tutor to generate comments.
   ``` yaml   
    - name: AI Tutor
      id: ai_tutor
      if: always()
      env:
        GOOGLE_API_KEY: ${{ secrets.GOOGLE_API_KEY }}
        SYNTAX_REPORT: ${{ steps.json.outputs.syntax }}
        RESULTS_REPORT: ${{ steps.json.outputs.results }}
      run: . test-env/bin/activate && echo $VIRTUAL_ENV && python -m pytest ./ai_tutor/ai_tutor.py
      timeout-minutes: 5
   ```

## Important Notes

* **Exercise file naming:** The AI Tutor assumes a single Python file starting with 'ex' in the project folder as the student's submission.
* **Report file naming:** The environment variables ending with '_REPORT' should contain paths to the generated JSON pytest report files.
* **Gemini API limitations:** Be mindful of the Gemini API usage limits and potential costs.

## Disclaimer

The AI Tutor is an experimental tool. While it strives to provide accurate and helpful feedback, it is not a substitute for human instruction or code review. Always encourage students to think critically and seek clarification from instructors or peers when needed.
